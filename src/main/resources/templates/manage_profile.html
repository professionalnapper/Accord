<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Your Profile</title>
    <link rel="icon" href="images/logoHead.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css"> 
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">   
    
</head>

<body>
    <div class="containerN">
        <div class="sidebar" style=" width: 322px; height: 100vh; background: white; box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25); position: fixed;
        left: 0; top: 0; display: flex; flex-direction: column; font-family: 'Lexend', sans-serif;">
            <img class="logo" style="width: 262px; height: 56px;" src="images/logo.png" alt="Logo" />
            <div class="nav-items" style=" flex-grow: 1; overflow-y: auto;">
                <a href="/dash_user" class="nav-item" style="height:39.44px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="17.33" height="17.70" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                    <div style="height: 19.44px; margin-top:-5px;padding-bottom:5px;">Dashboard</div>
                </a>
                <a href="/areas-user" class="nav-item" style="height:39.44px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 21h18"></path>
                        <path d="M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"></path>
                        <path d="M9 21v-4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v4"></path>
                        <rect x="9" y="7" width="6" height="4"></rect>
                    </svg>
                    <div style="height: 19.44px; margin-top:-5px; padding-bottom:2px;">Book a Facility</div>
                </a>
                <a href="/mb-user" class="nav-item" style="height:39.44px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <div style="height: 19.44px; margin-top:-5px;padding-bottom:2px;">Manage Bookings</div>
                </a>
                <a href="#" class="nav-item active"style="height:39.44px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="17.44" height="17.04" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <div style="height: 19.44px; margin-top:-4px;padding-bottom:2px;">Manage Profile</div>
                </a>
                <div class="nav-divider"></div>
                <a href="/" class="logout" style="height:39.44px">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                        <polyline points="16 17 21 12 16 7"></polyline>
                        <line x1="21" y1="12" x2="9" y2="12"></line>
                    </svg>
                    <div style="height: 19.44px; margin-top:-5px;padding-bottom:2px;">Log out</div>
                </a>        
            </div>

            <!-- for profile pic ni dapita -->
            <div class="profile">
                <!-- <div class="profile-pic" th:style="'background-image: url(' + ${user.profile_picture} + ');'">JD</div> -->
                <div class="profile-pic2">
                            
                    <!-- Check if the profile picture exists and display it -->
                    <img th:if="${profilePictureBase64 != null}" 
                        th:src="'data:image/jpeg;base64,' + ${profilePictureBase64}" 
                        alt="Profile Picture" style="width: 100%; height: 100%; border-radius: 50%;" />
                    
                    <!-- Fallback to show the user's initials (e.g., 'JD') if no profile picture is available -->
                    <span th:if="${profilePictureBase64 == null}" th:text="${user.name != null ? user.name.substring(0, 2).toUpperCase() : 'JD'}" style="font-size: medium;">JD</span>
                </div>
                        <!-- for profile pic ni dapita -->
                <div class="profile-info">
                    <div class="profile-name" style="margin-top:1px;" th:if="${user != null}" th:text="${user.name}">John Doe</div>
                    <div class="profile-name" th:unless="${user != null}">User not found</div>
                    <div class="profile-role" style="margin-top:-3px;" th:if="${user != null}" th:text="${user.property_status}">Homeowner</div>
                </div>
            </div>
        </div>
        
        <div class="main-content2" style="font-family: 'Lexend', 'sans-serif';">
            <form method="post" enctype="multipart/form-data" th:object="${user}">
            <h1 th:if="${user != null}" style="margin-top: 26px; font-family: 'Lexend', 'sans-serif'; font-weight: bold; font-size: 36px; ">Welcome, <span id="userName" th:text="${user.name}">John Doe</span>!</h1>
            <p class="subtitle">Update your profile and manage your account details.</p>

            <div class="form-container">
            
                <div style="margin-bottom: 30px;">
                    
                    <label style="display: block; color: black; font-size: 18px; font-weight: 500; margin-bottom: 10px;">Profile Picture</label>
                    <div style="display: flex; align-items: center;">
                        <!-- <div id="profilePicture" style="width: 150px; height: 150px; background: #FFCFBB; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; color: #FF5916; margin-right: 20px;" th:text="${user.profile_picture}">JD</div> -->
                        <div id="profilePicture" 
                            style="width: 150px; height: 150px; background: #FFCFBB; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 48px; color: #FF5916; margin-right: 20px;">
                            
                            
                            <img th:if="${profilePictureBase64 != null}" 
                                th:src="'data:image/jpeg;base64,' + ${profilePictureBase64}" 
                                alt="Profile Picture" style="width: 100%; height: 100%; border-radius: 50%;" />
                            
                            
                            <span th:if="${profilePictureBase64 == null}" th:text="${user.name != null ? user.name.substring(0, 2).toUpperCase() : 'JD'}">JD</span>
                        </div>
 
                        <div>
                            <input type="file" id="prof" name="prof" accept=".pdf,.doc,.docx,image/*">
                            <!--<label for="profile-picture" style="background: #FF5916; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; display: inline-block; margin-bottom: 10px;">Choose New Picture</label>-->
                            <p style="color: #646464; font-size: 14px; margin: 0;">Supported formats: JPG, PNG (max. 900KB)</p>
                        </div>
                    </div>
                </div>    
                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: black; font-size: 16px; font-weight: 500; margin-bottom: 5px;">Full Name</label>
                    <input type="text" id="name" th:field="*{name}" th:value="${user != null ? user.name : ''}" 
                        style="width: 100%; padding: 10px; border: 1px solid #dce0e5; border-radius: 5px; font-size: 16px;" disabled>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-bs-whatever="@mdo" style="background-color: #FF5916; border-color: #FF5916; margin-top: 4px; font-size: small;" >Edit Name</button>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="display: block; color: black; font-size: 16px; font-weight: 500; margin-bottom: 5px;">Email</label>
                    <input type="email" id="email" th:field="*{email}" th:value="${user != null ? user.email : ''}" 
                        style="width: 100%; padding: 10px; border: 1px solid #dce0e5; border-radius: 5px; font-size: 16px;" disabled>
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal2" data-bs-whatever="@fat" style="background-color: #FF5916; border-color: #FF5916; margin-top: 4px; font-size: small;">Edit Email</button>
                </div>

                <div style="margin-bottom: 30px;">
                    <label style="display: block; color: black; font-size: 16px; font-weight: 500; margin-bottom: 5px;">Password</label>
                    <input type="password" th:field="*{password}" th:value="${user != null ? user.password : ''}"  style="width: 100%; padding: 10px; border: 1px solid #dce0e5; border-radius: 5px; font-size: 16px;" disabled id="password">
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal3" data-bs-whatever="@getbootstrap" style="background-color: #FF5916; border-color: #FF5916; margin-top: 4px; font-size: small;">Edit Password</button>
                </div>





<!-- para fkng name -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Edit Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Name</label>
              <input type="text" class="form-control" id="recipient-name" th:value="${user != null ? user.name : ''}" disabled>
            </div>
            <div class="mb-3">
              <label for="ForNewname" class="col-form-label">New Name</label>
              <textarea class="form-control" id="ForNewname"></textarea>
            </div>
            <!-- Hidden input for user ID, making sure it's a valid Long value -->
            <input type="hidden" id="user-id" th:value="${user != null ? user.id : 0}"> <!-- Default value 0 if null -->
            
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="saveNameBtn" style="background-color: #FF5916; border-color: #FF5916; margin-top: 4px;">Save</button>
        </div>
      </div>
    </div>
  </div>
  
  
<!-- para fking email -->
<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Edit Email</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
            <div class="mb-3">
              <label for="recipient-name" class="col-form-label">Email</label>
              <input type="text" class="form-control" id="recipient-name" th:value="${user != null ? user.email : ''}" disabled>
            </div>
            <div class="mb-3">
              <label for="message-text" class="col-form-label">New Email</label>
              <textarea class="form-control" id="ForNewEmail"></textarea>
            </div>
            <input type="hidden" id="user-id" value="${user != null ? user.id : 0}">
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="saveEmailBtn" style="background-color: #FF5916; border-color: #FF5916; margin-top: 4px;">Save</button>
        </div>
      </div>
    </div>
  </div>
  <!-- para fking password -->
  <div class="modal fade" id="exampleModal3" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form>
           
            <div class="mb-3">
                <label for="current-password" class="col-form-label">Current Password</label>
                <input type="password" class="form-control" id="current-password" />
              </div>
              
            <div class="mb-3">
              <label for="message-text" class="col-form-label">New Password</label>
              <textarea class="form-control" id="ForNewpass"></textarea>
            </div>
            <input type="hidden" id="user-id" value="${user != null ? user.id : 0}">
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="savePassBtn" style="background-color: #FF5916; border-color: #FF5916; margin-top: 4px;">Save</button>
        </div>
      </div>
    </div>
  </div>

                
                <div style="text-align: right;">
                    <button id="saveProfile" style="background: #FF5916; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 16px; cursor: pointer; font-family: 'Lexend', sans-serif;">Save Changes</button>
                </div>
                <div th:if="${error}" class="error-message">
                    <p th:text="${error}"></p>
                </div>
            </div>
            </form>
            
        </div>
    </div>



<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script></body>
<!-- name script -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const saveNameBtn = document.getElementById("saveNameBtn");
        const modal = new bootstrap.Modal(document.getElementById("exampleModal")); 
    
        saveNameBtn.addEventListener("click", function () {
    const newName = document.getElementById("ForNewname").value;
    const userId = document.getElementById("user-id").value; 
    if (!newName.trim()) {
        alert("Please enter a valid name.");
        return;
    }

    if (!userId || isNaN(userId) || userId <= 0) {
        alert("Invalid user ID.");
        return;
    }

    fetch("/updateName", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({ id: userId, name: newName }),
    })
    .then(response => {
        if (response.ok) {
            alert("Name updated successfully!");
            window.location.reload();
        } else {
            response.text().then(text => alert("Error: " + text));
        }
    })
    .catch(error => {
        console.error("Error updating name:", error);
        alert("An error occurred. Please try again.");
    });
});
    });
    </script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const saveEmailBtn = document.getElementById("saveEmailBtn");
            const modal = new bootstrap.Modal(document.getElementById("exampleModal2")); 
        
            saveEmailBtn.addEventListener("click", function () {
    const newEmail = document.getElementById("ForNewEmail").value;
    const userId = document.getElementById("user-id").value; 

    console.log("New Email: ", newEmail);
    console.log("User ID: ", userId); 

    if (!newEmail.trim()) {
        alert("Please enter a valid email.");
        return;
    }

    if (!userId || isNaN(userId) || userId <= 0) {
        alert("Invalid user ID.");
        return;
    }

    fetch("/updateEmail", {
        method: "POST",
        headers: {    
            "Content-Type": "application/x-www-form-urlencoded",
        },
        body: new URLSearchParams({ id: userId, email: newEmail }),
    })
    .then(response => {
        if (response.ok) {
            alert("Email updated successfully!");
            window.location.reload();
        } else {
            response.text().then(text => alert("Error: " + text));    
        }
    })            
    .catch(error => {
        console.error("Error updating email:", error);
        alert("An error occurred. Please try again.");
    });
});
  });
    </script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function () {
  const savePassBtn = document.getElementById("savePassBtn");
  const modal = new bootstrap.Modal(document.getElementById("exampleModal3"));

  savePassBtn.addEventListener("click", function () {
    const currentPassword = document.getElementById("current-password").value;
    const newPassword = document.getElementById("ForNewpass").value;
    const userId = document.getElementById("user-id").value;

    if (!currentPassword.trim()) {
      alert("Please enter your current password.");
      return;
    }

    if (!newPassword.trim()) {
      alert("Please enter a valid new password.");
      return;
    }

    if (!userId || isNaN(userId) || userId <= 0) {
      alert("Invalid user ID.");
      return;
    }

    fetch("/updatePassword", {
      method: "POST",
      headers: {
        "Content-Type": "application/x-www-form-urlencoded",
      },
      body: new URLSearchParams({
        id: userId,
        currentPassword: currentPassword,
        newPassword: newPassword,
      }),
    })
      .then((response) => {
        if (response.ok) {
          alert("Password updated successfully!");
          window.location.reload();
        } else {
          response.text().then((text) => alert("Error: " + text));
        }
      })
      .catch((error) => {
        console.error("Error updating password:", error);
        alert("An error occurred. Please try again.");
      });
  });
});

        
    </script>
</html>
